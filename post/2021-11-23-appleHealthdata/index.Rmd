
---
title: Explore Apple Health Data
author: Christian Saal
date: '`r Sys.Date()`'
slug: []
categories: [blog]
tags: [R]
draft: FALSE
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(dpi=300, cache = TRUE, comment = NA)
knitr::opts_knit$set(global.par = TRUE)

setwd("~/Desktop/shortsave/webseite/content/post/2021-11-23-appleHealthdata/")

```

## Introduction

As a sport scientist some times it is useful to operate with heart rate data. Your Apple Watch can
detect you heart rate via an optical heart sensor [Apple
Support](https://support.apple.com/en-us/HT204666). Your data is stored locally on your device. The
export can be started very simply via the health app. What you get is an proper xml-file with all
your data. 

## Explore the xml-file

As i am most comfortable with R i started to search the internet for an short description how to
import my apple health data. I have found these possible solution
[Ryanpraski](https://www.ryanpraski.com/apple-health-data-how-to-export-analyze-visualize-guide/).
Also this Page helps me to solve the task [Jeff's GitHub Pages
site](https://jeffjjohnston.github.io/rstudio/rmarkdown/2016/04/28/explore-your-apple-watch-heart-rate-data.html). 

### Solution 1 using Package XML

```{r, eval=FALSE}

#### using XML

library(XML)

# load apple health export.xml file
xml <- xmlParse("Export.xml") 

# transform xml file to data frame - select the Record rows from the xml file
df <- XML:::xmlAttrsToDataFrame(xml["//Record"])
df <- data.table(df)
 
```

###  Solution 2 using Package 

```{r, eval=FALSE}
#### load package


library(xml2)
library(data.table)

#### read data
dat <- read_xml("Export.xml")

#### look at the structure
xml_structure(dat)[1]

#### fetch data 
dat <- xml_children(dat)
length(dat)

#### check record types
record_types <- xml_attr(dat, "type")
table(record_types)

#### subset  type
steps <- dat[which(record_types == "HKQuantityTypeIdentifierStepCount")]

#### show one entry
single_record_attrs <- xml_attrs(steps[10000])[[1]]

#### xml to data frame
df <- data.table(date= as.POSIXct(xml_attr(steps, "endDate")),
  creationDate = as.POSIXct(xml_attr(steps, "creationDate")),
  startDate = as.POSIXct(xml_attr(steps, "startDate")),
  steps = as.integer(xml_attr(steps, "value"))
  )

 
```

## Conclusion

Both ways seems to be appropriate to import your apple health data. After that you can start to
explore visually or numerically your data and do what you want. 
